"use strict";(self.webpackChunkmap_observer=self.webpackChunkmap_observer||[]).push([[773],{1773:(re,T,p)=>{p.r(T),p.d(T,{MapViewPageModule:()=>pe});var c=p(9808),e=p(5e3);let S=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.ez]]}),t})();var x=p(4996),r=p(7319);let U=(()=>{class t{constructor(n){this.store=n}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(r.yh))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-mapping-items-view"]],decls:0,vars:0,template:function(n,o){},styles:[""]}),t})();var _=p(655),I=p(8407),A=p(2937),d=p(561),h=p(1135),f=p(9841),Y=p(4986),R=p(4482),Z=p(5403),E=p(8421);const $={leading:!0,trailing:!1};var Q=p(5963);function X(t,s=Y.z,n=$){const o=(0,Q.H)(t,s);return function P(t,{leading:s,trailing:n}=$){return(0,R.e)((o,i)=>{let a=!1,m=null,l=null,w=!1;const ae=()=>{null==l||l.unsubscribe(),l=null,n&&(F(),w&&i.complete())},me=()=>{l=null,w&&i.complete()},O=u=>l=(0,E.Xf)(t(u)).subscribe(new Z.Q(i,ae,me)),F=()=>{if(a){a=!1;const u=m;m=null,i.next(u),!w&&O(u)}};o.subscribe(new Z.Q(i,u=>{a=!0,m=u,(!l||l.closed)&&(s?F():O(u))},()=>{w=!0,(!(n&&a&&l)||l.closed)&&i.complete()}))})}(()=>o,n)}var V=p(3151),j=p(9300),B=p(1365),v=p(4004),J=p(4987),y=p(3125),M=p(2382),z=p(1829),N=p(8626);function H(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"div",4),e._UZ(1,"app-asset-view",5),e.TgZ(2,"button",6),e.NdJ("click",function(){const a=e.CHM(n).$implicit;return e.oxw().removeAsset.emit(a.id)}),e._uU(3,"remove"),e.qZA(),e.qZA()}if(2&t){const n=s.$implicit;e.xp6(1),e.Q6J("asset",n)}}function L(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"div",4),e._UZ(1,"app-asset-movement",7),e.TgZ(2,"button",6),e.NdJ("click",function(){const a=e.CHM(n).$implicit;return e.oxw().removeMovement.emit(a.id)}),e._uU(3,"remove"),e.qZA(),e.qZA()}if(2&t){const n=s.$implicit;e.xp6(1),e.Q6J("movement",n)}}let D=(()=>{class t{constructor(){this.mappingItem=void 0,this.assets=void 0,this.movements=void 0,this.removeAsset=new e.vpe,this.removeMovement=new e.vpe}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-mapping-item"]],inputs:{mappingItem:"mappingItem",assets:"assets",movements:"movements"},outputs:{removeAsset:"removeAsset",removeMovement:"removeMovement"},decls:12,vars:3,consts:[[1,"border","p-1"],[1,"assets-container"],["class","d-flex flex-row",4,"ngFor","ngForOf"],[1,"movements-container"],[1,"d-flex","flex-row"],[1,"flex-grow-1",3,"asset"],[1,"btn","btn-link","flex-grow-0",3,"click"],[1,"flex-grow-1",3,"movement"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e._uU(1),e.qZA(),e.TgZ(2,"div",0),e.TgZ(3,"h3"),e._uU(4,"Assets"),e.qZA(),e.TgZ(5,"div",1),e.YNc(6,H,4,1,"div",2),e.qZA(),e.qZA(),e.TgZ(7,"div",0),e.TgZ(8,"h3"),e._uU(9,"Movements"),e.qZA(),e.TgZ(10,"div",3),e.YNc(11,L,4,1,"div",2),e.qZA(),e.qZA()),2&n&&(e.xp6(1),e.Oqu(null==o.mappingItem?null:o.mappingItem.description),e.xp6(5),e.Q6J("ngForOf",o.assets),e.xp6(5),e.Q6J("ngForOf",o.movements))},directives:[c.sg,z.F,N.W],styles:[".assets-container[_ngcontent-%COMP%], .movements-container[_ngcontent-%COMP%]{height:40px;overflow:auto;overflow-x:hidden}"],changeDetection:0}),t})();function G(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"app-mapping-item",1),e.NdJ("removeAsset",function(i){return e.CHM(n),e.oxw().removeAsset(i)})("removeMovement",function(i){return e.CHM(n),e.oxw().removeMovement(i)}),e.ALo(1,"async"),e.ALo(2,"async"),e.qZA()}if(2&t){const n=s.ngIf,o=e.oxw();e.Q6J("mappingItem",n)("assets",e.lcZ(1,3,o.assets$))("movements",e.lcZ(2,5,o.movements$))}}let W=(()=>{class t{constructor(n){this.store=n,this._id=new h.X(void 0),this.mappingItem$=(0,f.a)([this._id,this.store.pipe((0,r.Ys)(d.q.selectItemsEntities))]).pipe((0,v.U)(([o,i])=>o?i[o]:void 0)),this.assets$=(0,f.a)([this.mappingItem$,this.store.pipe((0,r.Ys)(d.q.selectAssetsEntities))]).pipe((0,v.U)(([o,i])=>{var a;return(null===(a=null==o?void 0:o.assets)||void 0===a?void 0:a.map(m=>i[m]))||[]})),this.movements$=(0,f.a)([this.mappingItem$,this.store.pipe((0,r.Ys)(d.q.selectAssetMovementsEntities))]).pipe((0,v.U)(([o,i])=>{var a;return(null===(a=null==o?void 0:o.movements)||void 0===a?void 0:a.map(m=>i[m]))||[]}))}set id(n){this._id.next(n)}get id(){return this._id.value}ngOnInit(){}removeAsset(n){this.id&&this.store.dispatch((0,y.XR)({assets:[n],mappingItem:this.id}))}removeMovement(n){this.id&&this.store.dispatch((0,y.S4)({movements:[n],mappingItem:this.id}))}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(r.yh))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-mapping-item-standalone"]],inputs:{id:"id"},decls:2,vars:3,consts:[[3,"mappingItem","assets","movements","removeAsset","removeMovement",4,"ngIf"],[3,"mappingItem","assets","movements","removeAsset","removeMovement"]],template:function(n,o){1&n&&(e.YNc(0,G,3,7,"app-mapping-item",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,o.mappingItem$))},directives:[c.O5,D],pipes:[c.Ov],styles:[""],changeDetection:0}),t})();const q=["map"];function K(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"button",7),e.NdJ("click",function(){const a=e.CHM(n).ngIf;return e.oxw().deleteItem(a)}),e._uU(2,"Delete Item"),e.qZA(),e._UZ(3,"app-mapping-item-standalone",8),e.qZA()}if(2&t){const n=s.ngIf;e.xp6(3),e.Q6J("id",n)}}const b={radius:3,fillColor:"#ff7800",color:"#000",weight:1,opacity:1,fillOpacity:.8},C=36e5;let g=class{constructor(s){this.store=s,this.rangeSliderMax=5e3,this.items$=this.store.pipe((0,r.Ys)(d.q.selectItemsEntities)),this.itemIdByMovement$=this.store.pipe((0,r.Ys)(d.q.selectItemIdByMovement)),this.assets$=this.store.pipe((0,r.Ys)(d.q.selectAssetsAll)),this.movements$=this.store.pipe((0,r.Ys)(d.q.selectAssetMovementsAll)),this.movementsTimeRange$=this.store.pipe((0,r.Ys)(d.q.selectAssetMovementsTimeRange)),this.selectedMoment$=new h.X(void 0),this.selectedItemId$=this.selectedMoment$.pipe((0,B.M)(this.itemIdByMovement$),(0,v.U)(([n,o])=>n?o[n]:void 0)),this._timeRange=new h.X(0),this.currentTime$=(0,f.a)([this._timeRange.pipe(X(50)),this.movementsTimeRange$]).pipe((0,v.U)(([n,o])=>o.start+Math.floor((o.end-o.start)*n/this.rangeSliderMax)),(0,V.d)({bufferSize:1,refCount:!0})),this.currentMovements$=(0,f.a)([this.movements$,this.currentTime$]).pipe((0,v.U)(([n,o])=>n.filter(i=>function k(t,s){return t.start<=s&&t.end>=s||t.start>=s-C&&t.start<=s+C||t.end>=s-C&&t.end<=s+C}(i,o))),(0,V.d)({bufferSize:1,refCount:!0})),this.map$=new h.X(null),this.geoJsonLayer$=new h.X(null)}set timeRange(s){this._timeRange.next(s)}get timeRange(){return this._timeRange.value}ngOnInit(){const s=this.currentMovements$.pipe((0,v.U)(n=>(console.error({movements:n}),{type:"FeatureCollection",features:n.map(o=>Object.assign(Object.assign({},o.geo),{properties:{id:o.id}}))})));(0,f.a)([s,this.geoJsonLayer$,this.map$]).pipe((0,j.h)(([n,o,i])=>!!o&&!!i),(0,J.t)(this)).subscribe(([n,o,i])=>{null==o||o.clearLayers(),n&&(null==o||o.addData(n))})}ngAfterViewInit(){var s;const n=I.map(null===(s=this.mapElement)||void 0===s?void 0:s.nativeElement).setView(A.E,A.T);I.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18,minZoom:3,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(n);const i=I.geoJSON(void 0,{pointToLayer:(a,m)=>I.circleMarker(m,b),onEachFeature:(a,m)=>{m.on("click",l=>{this.selectedMoment$.next(a.properties.id)})}});i.setStyle(a=>({color:(null==a?void 0:a.properties.color)||"#ffffff"})),this.geoJsonLayer$.next(i),i.addTo(n),this.map$.next(n)}deleteItem(s){this.store.dispatch((0,y.UA)({ids:[s]}))}};g.\u0275fac=function(s){return new(s||g)(e.Y36(r.yh))},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-map-view"]],viewQuery:function(s,n){if(1&s&&e.Gf(q,5),2&s){let o;e.iGM(o=e.CRH())&&(n.mapElement=o.first)}},decls:11,vars:11,consts:[["class","border p-3",4,"ngIf"],[1,"border","p-3"],["type","range","min","0",1,"slider",3,"max","ngModel","ngModelChange"],[1,"map-container"],[1,"map-frame"],[1,"map"],["map",""],[1,"btn","btn-secondary",3,"click"],[3,"id"]],template:function(s,n){1&s&&(e.YNc(0,K,4,1,"div",0),e.ALo(1,"async"),e.TgZ(2,"div",1),e.TgZ(3,"input",2),e.NdJ("ngModelChange",function(i){return n.timeRange=i}),e.qZA(),e._uU(4),e.ALo(5,"date"),e.ALo(6,"async"),e.qZA(),e.TgZ(7,"div",3),e.TgZ(8,"div",4),e._UZ(9,"div",5,6),e.qZA(),e.qZA()),2&s&&(e.Q6J("ngIf",e.lcZ(1,4,n.selectedItemId$)),e.xp6(3),e.Q6J("max",n.rangeSliderMax)("ngModel",n.timeRange),e.xp6(1),e.hij(" ",e.xi3(5,6,e.lcZ(6,9,n.currentTime$),"HH:mm dd-MM"),"\n"))},directives:[c.O5,M.eT,M.Fj,M.JJ,M.On,W],pipes:[c.Ov,c.uU],styles:[".slider[_ngcontent-%COMP%]{width:100%}.map[_ngcontent-%COMP%]{width:100%;height:800px}"],changeDetection:0}),g=(0,_.gn)([(0,J.c)()],g);const ee=[{path:"",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-map-view-page"]],decls:2,vars:0,template:function(n,o){1&n&&(e._UZ(0,"app-mapping-items-view"),e._UZ(1,"app-map-view"))},directives:[U,g],styles:[""],changeDetection:0}),t})()}];let te=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[x.Bz.forChild(ee)],x.Bz]}),t})();var ne=p(8796),se=p(8972);let oe=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.ez,ne.o,se.Y]]}),t})(),ie=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.ez,M.u5,M.UX,oe]]}),t})(),pe=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.ez,S,te,ie]]}),t})()}}]);